language: php
php:
  - 5.5
  - 5.6
  - 7.0
  - 7.1
  - hhvm
  
env:
  global:
    - DEFAULT=1
  matrix:
    - CAKE_VERSION='3.3.*'
    - CAKE_VERSION='3.4.*'
    - CAKE_VERSION='dev-3.next'

matrix:
  fast_finish: true
  allow_failures:
    - php: hhvm
    - php: 7.0
      env: PHPCS=1 DEFAULT=0
      
  include:
    - php: 7.0
      env: PHPCS=1 DEFAULT=0

  exclude:
    - php: 5.5
      env: CAKE_VERSION='3.4.*'
    - php: 5.5
      env: CAKE_VERSION='dev-3.next'


before_install:
  - if [[ $DEFAULT = 1 && $CAKE_VERSION != '3.3.*' && $TRAVIS_PHP_VERSION != 5.6 && $TRAVIS_PHP_VERSION != 5.5 ]] ; then travis_retry composer require phpunit/phpunit:^6.0 --no-interaction --prefer-stable ; else travis_retry composer require phpunit/phpunit --no-interaction --prefer-stable ; fi
  - if [[ $PHPCS = 1 ]] ; then travis_retry composer require "cakephp/cakephp-codesniffer:*" --no-interaction ; fi
  - if [[ $PHPCS = 1 ]] ; then ./vendor/bin/phpcs --config-set installed_paths /home/travis/build/multidimension-al/cakephp-subdomains/vendor/cakephp/cakephp-codesniffer ; fi

before_script:
  - travis_retry composer install --prefer-source --no-interaction

script:
  - if [[ $PHPCS = 1 ]] ; then ./vendor/bin/phpcs --standard=CakePHP ./src ; fi
  - if [[ $DEFAULT = 1 ]] ; then ./vendor/bin/phpunit --coverage-text --coverage-clover=coverage.clover ; fi

after_script:
  - if [[ $DEFAULT = 1 && $TRAVIS_PHP_VERSION != 'hhvm' && $TRAVIS_PHP_VERSION != 7.0 && $TRAVIS_PHP_VERSION != 7.1 ]] ; then wget https://scrutinizer-ci.com/ocular.phar ; fi
  - if [[ $DEFAULT = 1 && $TRAVIS_PHP_VERSION != 'hhvm' && $TRAVIS_PHP_VERSION != 7.0 && $TRAVIS_PHP_VERSION != 7.1 ]] ; then php ocular.phar code-coverage:upload --format=php-clover coverage.clover ; fi

notifications:
  email: false
